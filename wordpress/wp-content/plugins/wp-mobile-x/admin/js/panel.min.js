!function(e){function a(a){for(var t in a){for(var n=e('[data-name="'+t+'"]'),i="",r=0;r<a[t].y.length;r++)a[t].y[r]&&a[t].y[r].name&&(i+='<label class="checkbox-inline"><input name="'+t+'[]" checked type="checkbox" value="'+a[t].y[r].id+'"> '+a[t].y[r].name+"</label>");for(var c=0;c<a[t].n.length;c++)a[t].n[c]&&a[t].n[c].name&&(i+='<label class="checkbox-inline"><input name="'+t+'[]" type="checkbox" value="'+a[t].n[c].id+'"> '+a[t].n[c].name+"</label>");n.html(i)}}e("#j-panel-form").on("click",".upload-btn",function(a){a.preventDefault();var t,n=e(this).attr("id");t?t.open():((t=wp.media.frames.file_frame=wp.media({title:"选择文件",button:{text:"选择文件"},multiple:!1})).on("select",function(){var a=t.state().get("selection").first().toJSON(),i=n.replace(/_upload/i,"");e("#"+i).val(a.url)}),t.open())}).on("click",".toggle",function(){var a=e(this);a.hasClass("active")?(a.removeClass("active"),a.next().val(0)):(a.addClass("active"),a.next().val(1))}).on("click",".wpcom-panel-nav li",function(){var a=e(this),t=e(".wpcom-panel-item");e(".wpcom-panel-nav li").removeClass("active"),a.addClass("active"),t.removeClass("active"),t.eq(a.index()).addClass("active");var n=new Date;n.setTime(n.getTime()+31536e6),document.cookie="mobx_panel_nav="+a.index()+";expires="+n.toGMTString()+";path=/",a.hasClass("more-themes")||a.hasClass("theme-active")?e(".wpcom-panel-submit").hide():e(".wpcom-panel-submit").show()}).on("change",".toggle-wrap input",function(){var a=e(this);1==a.val()?a.parent().find(".toggle").addClass("active"):a.parent().find(".toggle").removeClass("active")}).find(".color-picker").wpColorPicker(),e("#j-panel-form .wpcom-panel-nav li.active").trigger("click"),e("#j-panel-form").length&&e.ajax({type:"get",url:"http://demo.wpcom.cn/preview/wp-mobile-x.json?t="+Date.parse(new Date),dataType:"jsonp",jsonpCallback:"callback",success:function(a){var t="";if(a.length)for(var n in a)t+='<div class="more-theme-item"><a class="more-theme-img" href="'+a[n].url+'" target="_blank"><img src="'+a[n].img+'"></a><a class="more-theme-title" href="'+a[n].url+'" target="_blank">'+a[n].title+"</a></div>";else t='<p style="padding: 30px 0;text-align: center;font-size: 16px;color: #999;">即将推出，敬请期待！</p>';e("#j-panel-form .more-theme-wrap").html(t)},error:function(){e("#j-panel-form .more-theme-wrap").html('<p style="padding: 30px 0;text-align: center;font-size: 16px;color: #999;">即将推出，敬请期待！</p>')}});e("#wpcom-panel-form").on("click",".j-repeat-add",function(){var a=e(this).parent().prev(),t=a.closest(".wpcom-panel-repeat"),n=a.html(),i=parseInt(a.data("id"))+1;n=(n=(n=(n=n.replace(/for="wpcom_(\S+)_(\d+)"/gim,'for="wpcom_$1_'+i+'"')).replace(/id="wpcom_(\S+)_(\d+)"/gim,'id="wpcom_$1_'+i+'"')).replace(/id="wpcom_(\S+)_(\d+)_upload"/gim,'id="wpcom_$1_'+i+'_upload"')).replace(/name="(\S+)\[(\d+)\](\[\])?"/gim,'name="$1['+i+']$3"'),0==a.find(".repeat-action").length?e('<div class="repeat-wrap" data-id="'+i+'">'+n+'<div class="repeat-action"><div class="repeat-item repeat-up j-repeat-up"><i class="dashicons dashicons-arrow-up-alt"></i></div><div class="repeat-item repeat-down j-repeat-down"><i class="dashicons dashicons-arrow-down-alt"></i></div><div class="repeat-item repeat-del j-repeat-del"><i class="dashicons dashicons-no-alt"></i></div></div></div>').insertAfter(a):e('<div class="repeat-wrap" data-id="'+i+'">'+n+"</div>").insertAfter(a);var r=t.find('[data-id="'+i+'"]');r.find("input[type=text]").val(""),r.find("textarea").val("");var c=r.find(".wp-picker-container");if(c.length)for(var l=0;l<c.length;l++)e(c[l]).replaceWith(e(c[l]).find(".color-picker"));r.find(".color-picker").wpColorPicker()}).on("click",".j-repeat-del",function(){e(this).closest(".repeat-wrap").remove()}).on("click",".j-repeat-up,.j-repeat-down",function(){var a=e(this),t=a.closest(".repeat-wrap"),n=t.prev(),i=n.data("id"),r=t.data("id");if(a.hasClass("j-repeat-down")){if(!(n=t.next()).hasClass("repeat-wrap"))return;i=n.data("id")}var c={};n.find("input,textarea,select").each(function(a,n){var l=e(n);if("checkbox"!=l.attr("type")&&"radio"!=l.attr("type")){var o=l.attr("name");if(o){var p=o.replace("["+i+"]","["+r+"]");c[p]=l.val(),l.val(t.find('[name="'+p+'"]').val()).trigger("change")}}}),n.find("input:checkbox:checked,input:radio:checked").each(function(a,t){var n=e(t),l=n.attr("name");if(l){var o=l.replace("["+i+"]","["+r+"]");c[o]=c[o]?c[o]:[],c[o].push(n.val())}});var l=[];t.find("input:checkbox:checked,input:radio:checked").each(function(a,t){var n=e(t),c=n.attr("name");if(c){var o=c.replace("["+r+"]","["+i+"]");l[o]=l[o]?l[o]:[],l[o].push(n.val())}}),n.find("input:checkbox,input:radio").each(function(a,t){var n=e(t),i=n.attr("name");i&&(n.prop("checked",!1),e.inArray(n.val(),l[i])>=0&&n.prop("checked",!0).trigger("change"))}),t.find("input, textarea, select").each(function(a,t){var n=e(t);"checkbox"!=n.attr("type")&&"radio"!=n.attr("type")&&n.val(c[n.attr("name")]).trigger("change")}),t.find("input:checkbox,input:radio").each(function(a,t){var n=e(t),i=n.attr("name");i&&(n.prop("checked",!1),e.inArray(n.val(),c[i])>=0&&n.prop("checked",!0).trigger("change"))})}),e("#j-check-version").click(function(){var a=e(this);a.html("检查中..."),e.getJSON(ajaxurl,{action:"mobx_check_version"},function(e){var t='<span class="check-version">最新版本：<span style="color: green;">'+e.version+'</span>，<a href="https://www.wpcom.cn/help/62.html" target="_blank">查看主题在线更新教程</a></span>';e.version==e.current&&(t='<span class="check-version">最新版本：<span style="color: green;">'+e.version+"</span>"),a.parent().append(t),a.hide()})});var t=e(".j-cat-sort"),n={};if(t.length)for(var i=0;i<t.length;i++){var r=e(t[i]).data("name");n[r]={},n[r].y=[],n[r].n=[],e(t[i]).find("label").each(function(a,t){e(t).find("input").is(":checked")?n[r].y.push({id:e(t).find("input").val(),name:e.trim(e(t).text())}):n[r].n.push({id:e(t).find("input").val(),name:e.trim(e(t).text())})})}a(n),t.on("change","input",function(){for(var t=e(this),i=t.closest(".j-cat-sort").data("name"),r=t.is(":checked"),c=0;c<n[i][r?"n":"y"].length;c++)n[i][r?"n":"y"][c]&&n[i][r?"n":"y"][c].id==t.val()&&delete n[i][r?"n":"y"][c];n[i][r?"y":"n"].push({id:t.val(),name:e.trim(t.parent().text())}),a(n)})}(jQuery);